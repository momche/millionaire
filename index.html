<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°—Ç–∞–Ω–∏ –±–æ–≥–∞—Ç</title>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    /* Ensure the page uses the full viewport with no scrolling */
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background-color: #000033;
      color: white;
    }
    /* Main container fills the viewport and uses flexbox */
    .game-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      background-color: #000066;
      padding: 10px;
    }
    /* Start screen styling */
    .start-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 10px;
    }
    .start-btn {
      background-color: #ffd700;
      color: #000033;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
    }
    /* Game screen uses flex so that all parts stay visible */
    #gameScreen {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 5px;
      box-sizing: border-box;
    }
    .info-container {
      flex: 0 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }
    .prize-table {
      background-color: #000099;
      border-radius: 8px;
      padding: 5px;
      width: 150px;
      flex: 0 0 auto;
    }
    .prize-level {
      padding: 3px 5px;
      margin: 2px 0;
      font-size: 12px;
    }
    .prize-level.current {
      background-color: #ffd700;
      color: #000033;
      font-weight: bold;
    }
    .question-container {
      flex: 0 0 auto;
      background-color: #000099;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      margin-bottom: 5px;
    }
    .answers-container {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px;
      margin-bottom: 5px;
    }
    .answer-btn {
      background-color: #000099;
      border: 2px solid #4444ff;
      border-radius: 5px;
      padding: 8px;
      font-size: 16px;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }
    .answer-btn:hover {
      background-color: #0000cc;
    }
    .answer-btn.correct {
      background-color: #008800;
      border-color: #00ff00;
    }
    .answer-btn.wrong {
      background-color: #880000;
      border-color: #ff0000;
    }
    .answer-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .lifelines {
      flex: 0 0 auto;
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-bottom: 5px;
    }
    .lifeline-btn {
      background-color: #ffd700;
      color: #000033;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      font-size: 12px;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .lifeline-btn:hover {
      transform: scale(1.1);
    }
    .next-btn {
      flex: 0 0 auto;
      background-color: #ffd700;
      color: #000033;
      border: none;
      border-radius: 5px;
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px auto;
    }
    .game-over {
      flex: 0 0 auto;
      text-align: center;
      margin-top: 5px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <!-- Start Screen -->
    <div id="startScreen" class="start-screen">
      <h1>–°—Ç–∞–Ω–∏ –±–æ–≥–∞—Ç</h1>
      <p>–û—Ç–≥–æ–≤–∞—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–æ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏ –∏ –ø–µ—á–µ–ª–µ—Ç–µ –≤–∏—Ä—Ç—É–∞–ª–Ω–∏ –ø–∞—Ä–∏!</p>
      <p>–ò–º–∞—Ç–µ 4 –∂–æ–∫–µ—Ä–∞ –∑–∞ –ø–æ–º–æ—â.</p>
      <button id="startBtn" class="start-btn">–ó–∞–ø–æ—á–Ω–∏ –∏–≥—Ä–∞—Ç–∞</button>
    </div>
    <!-- Game Screen -->
    <div id="gameScreen" class="hidden">
      <div class="info-container">
        <div>
          <h3>–í—ä–ø—Ä–æ—Å <span id="questionNumber">1</span>/15</h3>
          <h3>–°—É–º–∞: <span id="currentPrize">0</span> –ª–≤.</h3>
        </div>
        <div class="prize-table">
          <div class="prize-level" data-level="15">15. 100,000 –ª–≤.</div>
          <div class="prize-level" data-level="14">14. 50,000 –ª–≤.</div>
          <div class="prize-level" data-level="13">13. 25,000 –ª–≤.</div>
          <div class="prize-level" data-level="12">12. 10,000 –ª–≤.</div>
          <div class="prize-level" data-level="11">11. 5,000 –ª–≤.</div>
          <div class="prize-level" data-level="10">10. 3,000 –ª–≤.</div>
          <div class="prize-level" data-level="9">9. 2,000 –ª–≤.</div>
          <div class="prize-level" data-level="8">8. 1,500 –ª–≤.</div>
          <div class="prize-level" data-level="7">7. 1,000 –ª–≤.</div>
          <div class="prize-level" data-level="6">6. 500 –ª–≤.</div>
          <div class="prize-level" data-level="5">5. 300 –ª–≤.</div>
          <div class="prize-level" data-level="4">4. 200 –ª–≤.</div>
          <div class="prize-level" data-level="3">3. 100 –ª–≤.</div>
          <div class="prize-level" data-level="2">2. 50 –ª–≤.</div>
          <div class="prize-level current" data-level="1">1. 0 –ª–≤.</div>
        </div>
      </div>
      <div class="lifelines">
        <button id="fifty" class="lifeline-btn" title="50:50">50:50</button>
        <button id="phone" class="lifeline-btn" title="–û–±–∞–¥–∏ —Å–µ –Ω–∞ –ø—Ä–∏—è—Ç–µ–ª">‚òéÔ∏è</button>
        <button id="audience" class="lifeline-btn" title="–ü–æ–º–æ—â –æ—Ç –ø—É–±–ª–∏–∫–∞—Ç–∞">üë•</button>
        <button id="switch" class="lifeline-btn" title="–°–º—è–Ω–∞ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∞">‚Ü∫</button>
      </div>
      <div class="question-container">
        <h2 id="question">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å...</h2>
      </div>
      <div class="answers-container">
        <button class="answer-btn" data-index="0">A: </button>
        <button class="answer-btn" data-index="1">B: </button>
        <button class="answer-btn" data-index="2">C: </button>
        <button class="answer-btn" data-index="3">D: </button>
      </div>
      <button id="nextBtn" class="next-btn hidden">–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å</button>
      <div id="gameOver" class="game-over hidden">
        <h2>–ò–≥—Ä–∞—Ç–∞ –ø—Ä–∏–∫–ª—é—á–∏!</h2>
        <p>–í–∏–µ —Å–ø–µ—á–µ–ª–∏—Ö—Ç–µ: <span id="finalPrize">0</span> –ª–≤.</p>
        <button id="restartBtn" class="start-btn">–ò–≥—Ä–∞–π –æ—Ç–Ω–æ–≤–æ</button>
      </div>
    </div>
  </div>

  <script>
    /* Global State Variables */
    let gameQuestions = [];
    let questions = [];
    let currentLevel = 1;
    let currentQuestion = 0;
    let usedQuestions = [];
    let lifelinesUsed = { fifty: false, phone: false, audience: false, switch: false };
    let answerSelected = false;
    const prizes = [0,50,100,200,300,500,1000,1500,2000,3000,5000,10000,25000,50000,100000];

    // Change this URL to your GitHub raw CSV URL.
    const CSV_URL = "https://raw.githubusercontent.com/YourUsername/YourRepo/main/questions.csv";

    /* CSV Loader using PapaParse */
    function loadCSVQuestions(csvUrl, callback) {
      Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: function(results) {
          const raw = results.data;
          gameQuestions = raw.map(q => ({
            question: q.question,
            answers: [q.answer1, q.answer2, q.answer3, q.answer4],
            correct: parseInt(q.correct),
            level: parseInt(q.level)
          }));
          console.log("Loaded CSV Questions:", gameQuestions);
          callback();
        },
        error: function(err) {
          console.error("CSV Load Error:", err);
          alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ –æ—Ç CSV.");
        }
      });
    }

    /* DOM Elements */
    const startScreen = document.getElementById('startScreen');
    const gameScreen = document.getElementById('gameScreen');
    const questionElem = document.getElementById('question');
    const answerBtns = document.querySelectorAll('.answer-btn');
    const lifelines = {
      fifty: document.getElementById('fifty'),
      phone: document.getElementById('phone'),
      audience: document.getElementById('audience'),
      switch: document.getElementById('switch')
    };
    const nextBtn = document.getElementById('nextBtn');
    const gameOver = document.getElementById('gameOver');
    const finalPrize = document.getElementById('finalPrize');
    const currentPrize = document.getElementById('currentPrize');
    const questionNumber = document.getElementById('questionNumber');
    const prizeElements = document.querySelectorAll('.prize-level');
    const startBtn = document.getElementById('startBtn');
    const offlineBtn = document.getElementById('offlineBtn'); // (If exists)

    /* Initialize Game */
    function initializeGame() {
      currentLevel = 1;
      usedQuestions = [];
      lifelinesUsed = { fifty: false, phone: false, audience: false, switch: false };
      answerSelected = false;
      questionNumber.textContent = currentLevel;
      currentPrize.textContent = "0";
      updatePrizeTable();
      Object.keys(lifelinesUsed).forEach(key => { lifelines[key].disabled = false; });
      loadQuestion();
    }

    function loadQuestion() {
      answerSelected = false;
      nextBtn.classList.add('hidden');
      // Reset answer buttons
      answerBtns.forEach(btn => { 
        btn.classList.remove('correct', 'wrong', 'disabled'); 
        btn.disabled = false; 
      });
      // Enable lifelines if not used
      Object.keys(lifelinesUsed).forEach(key => { lifelines[key].disabled = lifelinesUsed[key]; });
      // Filter questions for current level
      const levelQuestions = questions.filter(q => q.level === currentLevel && !usedQuestions.includes(questions.indexOf(q)));
      if (levelQuestions.length === 0) {
        let questionFound = false;
        for (let i = currentLevel + 1; i <= 15; i++) {
          const higherLevelQuestions = questions.filter(q => q.level === i && !usedQuestions.includes(questions.indexOf(q)));
          if (higherLevelQuestions.length > 0) {
            currentQuestion = questions.indexOf(higherLevelQuestions[Math.floor(Math.random() * higherLevelQuestions.length)]);
            questionFound = true;
            break;
          }
        }
        if (!questionFound) {
          usedQuestions = [];
          currentQuestion = Math.floor(Math.random() * questions.length);
        }
      } else {
        currentQuestion = questions.indexOf(levelQuestions[Math.floor(Math.random() * levelQuestions.length)]);
      }
      if (!usedQuestions.includes(currentQuestion)) { usedQuestions.push(currentQuestion); }
      questionElem.textContent = questions[currentQuestion].question;
      answerBtns.forEach((btn, index) => {
        btn.textContent = String.fromCharCode(65 + index) + ": " + questions[currentQuestion].answers[index];
      });
    }

    function loadNextQuestion() {
      if (currentLevel < 15) {
        currentLevel++;
        questionNumber.textContent = currentLevel;
        loadQuestion();
        updatePrizeTable();
      } else {
        endGame(true);
      }
    }

    function updatePrizeTable() {
      prizeElements.forEach(elem => {
        const lvl = parseInt(elem.getAttribute('data-level'));
        elem.classList.remove('current');
        if (lvl === currentLevel) {
          elem.classList.add('current');
          currentPrize.textContent = prizes[currentLevel - 1];
        }
      });
    }

    function endGame(won) {
      let finalAmount = 0;
      if (won) {
        finalAmount = prizes[14];
      } else {
        if (currentLevel > 10) { finalAmount = prizes[9]; }
        else if (currentLevel > 5) { finalAmount = prizes[4]; }
      }
      finalPrize.textContent = finalAmount;
      gameOver.classList.remove('hidden');
      nextBtn.classList.add('hidden');
    }

    /* Lifeline functions */
    function useFiftyFifty() {
      if (lifelinesUsed.fifty || answerSelected) return;
      lifelinesUsed.fifty = true;
      lifelines.fifty.disabled = true;
      const correctIndex = questions[currentQuestion].correct;
      let wrongIndices = [0,1,2,3].filter(i => i !== correctIndex);
      wrongIndices = shuffleArray(wrongIndices);
      for (let i = 0; i < 2; i++) {
        const btnIndex = wrongIndices[i];
        answerBtns[btnIndex].classList.add('disabled');
        answerBtns[btnIndex].disabled = true;
      }
    }
    
    function usePhoneFriend() {
      if (lifelinesUsed.phone || answerSelected) return;
      lifelinesUsed.phone = true;
      lifelines.phone.disabled = true;
      const correctIndex = questions[currentQuestion].correct;
      let friendResponse;
      if (Math.random() < 0.75) {
        friendResponse = `<div style="background-color:#000099;padding:10px;border-radius:5px;margin:10px 0;">
                          <p><strong>–ü—Ä–∏—è—Ç–µ–ª:</strong> –ú–∏—Å–ª—è, —á–µ –æ—Ç–≥–æ–≤–æ—Ä—ä—Ç –µ ${String.fromCharCode(65+correctIndex)}. ${Math.random()>0.5?"–ü–æ—á—Ç–∏ —Å–∏–≥—É—Ä–µ–Ω.":"–ù–æ –Ω–µ —Å—ä–º —Å–∏–≥—É—Ä–µ–Ω."}</p>
                          </div>`;
      } else {
        let wrongIndices = [0,1,2,3].filter(i => i !== correctIndex);
        const randomWrong = wrongIndices[Math.floor(Math.random()*wrongIndices.length)];
        friendResponse = `<div style="background-color:#000099;padding:10px;border-radius:5px;margin:10px 0;">
                          <p><strong>–ü—Ä–∏—è—Ç–µ–ª:</strong> –í–µ—Ä–æ—è—Ç–Ω–æ –æ—Ç–≥–æ–≤–æ—Ä—ä—Ç –µ ${String.fromCharCode(65+randomWrong)}.</p>
                          </div>`;
      }
      // Insert response into lifeline result area (if present)
      let lifelineResultEl = document.getElementById('lifeline-result');
      if(lifelineResultEl) {
        lifelineResultEl.innerHTML = friendResponse;
        lifelineResultEl.classList.remove('hidden');
      }
    }
    
    function useAudience() {
      if (lifelinesUsed.audience || answerSelected) return;
      lifelinesUsed.audience = true;
      lifelines.audience.disabled = true;
      const correctIndex = questions[currentQuestion].correct;
      let votes = [0,0,0,0];
      votes[correctIndex] = 40 + Math.floor(Math.random()*31);
      let remainingVotes = 100 - votes[correctIndex];
      for (let i = 0; i < 4; i++) {
        if (i !== correctIndex) {
          if (i === 3) { votes[i] = remainingVotes; }
          else { votes[i] = Math.floor(Math.random()*remainingVotes); remainingVotes -= votes[i]; }
        }
      }
      let audienceHTML = `<div style="background-color:#000099;padding:10px;border-radius:5px;margin:10px 0;">
                            <p><strong>–†–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –ø—É–±–ª–∏–∫–∞—Ç–∞:</strong></p>
                            <div style="display:flex;justify-content:space-between;margin-top:10px;">`;
      for (let i = 0; i < 4; i++) {
        audienceHTML += `<div style="text-align:center;width:22%;">
                           <div>${String.fromCharCode(65+i)}</div>
                           <div style="background-color:#ffd700;height:100px;position:relative;">
                             <div style="position:absolute;bottom:0;width:100%;background-color:#0000cc;height:${votes[i]}px;"></div>
                           </div>
                           <div>${votes[i]}%</div>
                         </div>`;
      }
      audienceHTML += `</div></div>`;
      let lifelineResultEl = document.getElementById('lifeline-result');
      if(lifelineResultEl) {
        lifelineResultEl.innerHTML = audienceHTML;
        lifelineResultEl.classList.remove('hidden');
      }
    }
    
    function useSwitch() {
      if (lifelinesUsed.switch || answerSelected) return;
      lifelinesUsed.switch = true;
      lifelines.switch.disabled = true;
      const index = usedQuestions.indexOf(currentQuestion);
      if (index > -1) { usedQuestions.splice(index,1); }
      loadQuestion();
    }
    
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    // Answer selection event
    answerBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        if (answerSelected) return;
        const chosenIndex = parseInt(this.getAttribute('data-index'));
        answerSelected = true;
        const correct = chosenIndex === questions[currentQuestion].correct;
        if (correct) {
          this.classList.add('correct');
          nextBtn.classList.remove('hidden');
          updatePrizeTable();
        } else {
          this.classList.add('wrong');
          answerBtns[questions[currentQuestion].correct].classList.add('correct');
          endGame(false);
        }
        Object.keys(lifelines).forEach(key => {
          if (!lifelinesUsed[key]) { lifelines[key].disabled = true; }
        });
      });
    });
    
    // Next Question button event
    nextBtn.addEventListener("click", function() {
      loadNextQuestion();
    });
    
        startBtn.addEventListener("click", function () {
    loadCSVQuestions("https://raw.githubusercontent.com/momche/millionaire/refs/heads/main/questions.csv", () => {
        questions = gameQuestions.slice();
        startScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        initializeGame();
    });
    });

    
    // Restart game event
    document.getElementById("restartBtn").addEventListener("click", function(){
      location.reload();
    });
    
    // (Optional) Offline button alert if it exists
    if(offlineBtn){
      offlineBtn.addEventListener("click", function(){
        alert("–ú–æ–ª—è, –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ CSV –∑–∞ –¥–∏–Ω–∞–º–∏—á–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏!");
      });
    }
  </script>
</body>
</html>
